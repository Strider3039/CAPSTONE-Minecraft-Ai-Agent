{
  "$schema": "https://json-schema.org/draft-07/schema",
  "title": "Event v0",
  "type": "object",
  "required": ["type", "timestamp", "schema_version", "kind", "payload"],
  "properties": {
    "type": { "const": "event" },
    "schema_version": { "const": "v0" },
    "timestamp": { "type": "number" },
    "kind": {
      "type": "string",
      "enum": ["ack", "schema_mismatch", "heartbeat", "latency_stats", "policy_error"]
    },
    "payload": { "type": "object" }
  },
  "additionalProperties": false,
  "$defs": {
    "ack": {
      "type": "object",
      "required": ["seq"],
      "properties": { "seq": { "type": "integer", "minimum": 0 } },
      "additionalProperties": false
    },
    "schema_mismatch": {
      "type": "object",
      "required": ["reason"],
      "properties": { "reason": { "type": "string" } },
      "additionalProperties": true
    },
    "heartbeat": {
      "type": "object",
      "required": ["uptime_s"],
      "properties": { "uptime_s": { "type": "number", "minimum": 0 } },
      "additionalProperties": false
    },
    "latency_stats": {
      "type": "object",
      "required": ["p50_ms", "p90_ms", "hz"],
      "properties": {
        "p50_ms": { "type": "number", "minimum": 0 },
        "p90_ms": { "type": "number", "minimum": 0 },
        "hz": { "type": "number", "minimum": 0 }
      },
      "additionalProperties": false
    },
    "policy_error": {
      "type": "object",
      "required": ["error"],
      "properties": { "error": { "type": "string" } },
      "additionalProperties": true
    }
  },
  "allOf": [
    { "if": { "properties": { "kind": { "const": "ack" } } }, "then": { "properties": { "payload": { "$ref": "#/$defs/ack" } } } },
    { "if": { "properties": { "kind": { "const": "schema_mismatch" } } }, "then": { "properties": { "payload": { "$ref": "#/$defs/schema_mismatch" } } } },
    { "if": { "properties": { "kind": { "const": "heartbeat" } } }, "then": { "properties": { "payload": { "$ref": "#/$defs/heartbeat" } } } },
    { "if": { "properties": { "kind": { "const": "latency_stats" } } }, "then": { "properties": { "payload": { "$ref": "#/$defs/latency_stats" } } } },
    { "if": { "properties": { "kind": { "const": "policy_error" } } }, "then": { "properties": { "payload": { "$ref": "#/$defs/policy_error" } } } }
  ]
}
